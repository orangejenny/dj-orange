{% extends 'rhyme/base.html' %}

{% block js %}{{ block.super }}
    <script src="/static/rhyme/js/albums.js"></script>
{% endblock js %}

{% block controls %}{{ block.super }}
    <button type="button" class="btn btn-xs btn-info" id="add-album">
        <span class="fas fa-plus"></span>
        New
    </button>
{% endblock controls %}

{% block content %}
    {% include "rhyme/partials/infinite_scroll_item_count.html" with text="albums" %}
    <div class="infinite-scroll-container" data-url="{% url "album_list" %}" data-template="#album-template">
        <div class="infinite-scroll-data albums clearfix"></div>
    </div>
{% endblock content %}

{% block templates %}
    <script type="text/html" id="album-template">
        <div data-id="<%= id %>" class="album clearfix">
            <div class="cover-art<% if (!cover_art_filename) { %> missing<% } %>"
                <% if (color) { %>style="background-color: #<%= color.hex_code %>; color: <% if (color.white_text) { %>white<% } else { %>black<% } %>;"<% } %>>
                <% if (cover_art_filename) { %>
                    <img src='<%= cover_art_filename %>' />
                <% } else { %>
                    <div class="acronym-<%= acronym_size %>"><%= acronym %></div>
                <% } %>
                <div class="details-background">
                    <div class="details">
                        <div>Acquired <%= date_acquired %></div>
                        <%= export_html %><br><br>
                        <div class="ratings">
                            <div>
                                <div class="rating">{% include "rhyme/partials/rating.html" with rating_attribute="stats.rating.max" icon="star" %}</div>
                                <div class="rating">{% include "rhyme/partials/rating.html" with rating_attribute="stats.energy.max" icon="fire" %}</div>
                                <div class="rating">{% include "rhyme/partials/rating.html" with rating_attribute="stats.mood.max" icon="heart" %}</div>
                            </div>
                            <div>
                                <div class="rating">{% include "rhyme/partials/rating.html" with rating_attribute="stats.rating.avg" icon="star" %}</div>
                                <div class="rating">{% include "rhyme/partials/rating.html" with rating_attribute="stats.energy.avg" icon="fire" %}</div>
                                <div class="rating">{% include "rhyme/partials/rating.html" with rating_attribute="stats.mood.avg" icon="heart" %}</div>
                            </div>
                            <div>
                                <div class="rating">{% include "rhyme/partials/rating.html" with rating_attribute="stats.rating.min" icon="star" %}</div>
                                <div class="rating">{% include "rhyme/partials/rating.html" with rating_attribute="stats.energy.min" icon="fire" %}</div>
                                <div class="rating">{% include "rhyme/partials/rating.html" with rating_attribute="stats.mood.min" icon="heart" %}</div>
                            </div>
                            <br>
                            <% if (completion_text) { %>
                                <div><%= completion_text %></div>
                            <% } %>
                            <div class="tags">
                                <% _.each(tags, function(tag) { %>
                                    <div><%= tag %></div>
                                <% }) %>
                            </div>
                        </div>
                        <div style="position: absolute; bottom: 10px; right: 10px;">
                            {% include "rhyme/partials/export_action.html" with url="<%= export_url %>" %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="name"><%= name %></div>
            <div class="artist"><%= artist %></div>
        </div>
    </script>
{% endblock templates %}

{% block modals %}
    <div id="new-album" class="modal">
        <form method="POST" action="{% url "new_album" %}">
            {% csrf_token %}
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">
                            <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                        </button>
                        <h4>
                            <input type='text' name='album_name' placeholder='album' />
                            <label>
                                <input type='checkbox' name='is_mix' />
                                is mix
                            </label>
                        </h4>
                    </div>
                    <div class="modal-body">
                        <table>
                            <tr class='song hide'>
                                <td class='ordinal'>0</td>
                                <td><input type='text' name='song_name' placeholder='song' /></td>
                                <td><input type='text' name='artist' placeholder='artist' /></td>
                                <td>
                                    <input type='text' name='minutes' placeholder='0' />
                                    :
                                    <input type='text' name='seconds' placeholder='00' />
                                </td>
                                <td><span class='fas fa-trash'></span></td>
                            </tr>
                        </table>
                        <div id="add-song">
                            <button class='btn btn-default btn-large'>
                                <span class='fas fa-plus'></span>
                            </button>
                            <input type='text' value='1' />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id='cancel-add-album' class='btn btn-default btn-large'>
                            Cancel
                        </button>
                        <button id='save-album' class='btn btn-primary btn-large'>
                            Save
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
{% endblock %}
